name = "gpg-signing-service-test"
main = "src/index.ts"
compatibility_date = "2025-11-13"
compatibility_flags = ["nodejs_compat"]

# Durable Objects
[[durable_objects.bindings]]
name = "KEY_STORAGE"
class_name = "KeyStorage"

[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiter"

# Migrations for Durable Objects
[[migrations]]
tag = "v1"
new_classes = ["KeyStorage", "RateLimiter"]

# D1 Database for audit logs (use local database for tests)
[[d1_databases]]
binding = "AUDIT_DB"
database_name = "gpg-signing-audit-test"
database_id = "test-database-id"

# KV for JWKS caching (use local KV for tests)
[[kv_namespaces]]
binding = "JWKS_CACHE"
id = "test-kv-id"

# Environment variables for testing
[vars]
ALLOWED_ISSUERS = "https://token.actions.githubusercontent.com,https://gitlab.com"
KEY_ID = "test-key-v1"
ADMIN_TOKEN = "test-admin-token"
KEY_PASSPHRASE = "test-passphrase"
